"use strict";(self.webpackChunknextjs_template=self.webpackChunknextjs_template||[]).push([[5516],{"./.storybook/mockToastify.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>ToastContainer,o:()=>toast});var console=__webpack_require__("./node_modules/console-browserify/index.js");const toast={success:message=>console.log("Toast success:",message),error:message=>console.log("Toast error:",message),info:message=>console.log("Toast info:",message),warning:message=>console.log("Toast warning:",message)},ToastContainer=()=>null},"./src/components/DocumentPreview.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>DocumentPreview});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_lib_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/lib/types.ts"),_lib_hooks_useDocuments__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/lib/hooks/useDocuments.ts"),_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/lucide-react/dist/esm/icons/loader.js"),_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/lucide-react/dist/esm/icons/download.js"),_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/lucide-react/dist/esm/icons/languages.js"),_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/lucide-react/dist/esm/icons/x.js"),_lib_trpc_client__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/lib/trpc/client.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");const DocumentPreview=({document,onClose,onRequestTranslation,className=""})=>{const[previewUrl,setPreviewUrl]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null),[isLoading,setIsLoading]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!0),[error,setError]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null),[isTranslating,setIsTranslating]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[translationStatus,setTranslationStatus]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null),{downloadDocument,previewDocument}=(0,_lib_hooks_useDocuments__WEBPACK_IMPORTED_MODULE_3__.U)(),getTranslationStatus=_lib_trpc_client__WEBPACK_IMPORTED_MODULE_4__.i.translations.getTranslationStatus.useQuery({documentId:document.id,targetLanguage:document.language===_lib_types__WEBPACK_IMPORTED_MODULE_2__.TM.ENGLISH?_lib_types__WEBPACK_IMPORTED_MODULE_2__.TM.FRENCH:_lib_types__WEBPACK_IMPORTED_MODULE_2__.TM.ENGLISH},{enabled:document.isTranslated||null!==document.translatedDocumentId,refetchInterval:5e3});(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((()=>{loadPreview()}),[document.id]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((()=>{getTranslationStatus.data&&setTranslationStatus(getTranslationStatus.data.status)}),[getTranslationStatus.data]);const loadPreview=async()=>{setIsLoading(!0),setError(null);try{const url=await previewDocument(document.id);url?setPreviewUrl(url):setError("Failed to load document preview")}catch(err){console.error("Error loading preview:",err),setError("An error occurred while loading the preview")}finally{setIsLoading(!1)}},handleDownload=async()=>{await downloadDocument(document.id,document.title)};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden flex flex-col ${className}`,"data-testid":"document-preview-container",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center","data-testid":"document-preview-header",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white truncate","data-testid":"document-title",children:document.title}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-center space-x-2",children:[onRequestTranslation&&!document.isTranslated&&"pending"!==translationStatus&&!document.translatedDocumentId&&(document.language===_lib_types__WEBPACK_IMPORTED_MODULE_2__.TM.ENGLISH||document.language===_lib_types__WEBPACK_IMPORTED_MODULE_2__.TM.FRENCH||document.language===_lib_types__WEBPACK_IMPORTED_MODULE_2__.TM.ARABIC)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{onClick:async()=>{if(onRequestTranslation){setIsTranslating(!0);try{await onRequestTranslation(document.id),setTranslationStatus("pending")}catch(error){console.error("Error requesting translation:",error)}finally{setIsTranslating(!1)}}},disabled:isTranslating||"pending"===translationStatus,className:`p-2 ${isTranslating||"pending"===translationStatus?"text-gray-400 cursor-not-allowed":"text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400"} rounded-full flex items-center`,title:"Request Translation","data-testid":"request-translation-button",children:isTranslating?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_5__.A,{className:"h-5 w-5 animate-spin"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_7__.A,{className:"h-5 w-5"})}),"pending"===translationStatus&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("span",{className:"text-xs text-yellow-600 dark:text-yellow-400 flex items-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_5__.A,{className:"h-3 w-3 animate-spin mr-1"}),"Translation in progress"]}),document.isTranslated&&"completed"===translationStatus&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-xs text-green-600 dark:text-green-400",children:"Translation available"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{onClick:handleDownload,className:"p-2 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 rounded-full",title:"Download","data-testid":"download-button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_6__.A,{className:"h-5 w-5"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{onClick:onClose,className:"p-2 text-gray-600 dark:text-gray-300 hover:text-red-600 dark:hover:text-red-400 rounded-full",title:"Close","data-testid":"close-button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_8__.A,{className:"h-5 w-5"})})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"flex-1 min-h-[400px] overflow-auto","data-testid":"document-preview-content",children:isLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-12","data-testid":"loading-state",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_5__.A,{className:"h-12 w-12 text-blue-500 animate-spin mb-4"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading preview..."})]}):error?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-12","data-testid":"error-state",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-red-500 mb-4",children:error}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{onClick:loadPreview,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700","data-testid":"retry-button",children:"Retry"})]}):previewUrl?document.fileType.includes("pdf")?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("iframe",{src:`${previewUrl}#toolbar=0`,className:"w-full h-full border-0",title:document.title,"data-testid":"document-preview-iframe"}):document.fileType.includes("image")?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"flex items-center justify-center h-full","data-testid":"image-preview-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("img",{src:previewUrl,alt:document.title,className:"max-w-full max-h-full object-contain","data-testid":"document-preview-image"})}):document.fileType.includes("text")||document.fileType.includes("html")||document.fileType.includes("json")?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("iframe",{src:previewUrl,className:"w-full h-full border-0",title:document.title,"data-testid":"document-preview-iframe"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-12","data-testid":"unsupported-file-type",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Preview not available for this file type"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("button",{onClick:handleDownload,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center","data-testid":"download-instead-button",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_6__.A,{className:"h-4 w-4 mr-2"}),"Download Instead"]})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-12","data-testid":"no-preview-state",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"No preview available"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("button",{onClick:handleDownload,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center","data-testid":"download-instead-button",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_Download_Languages_Loader_X_lucide_react__WEBPACK_IMPORTED_MODULE_6__.A,{className:"h-4 w-4 mr-2"}),"Download Instead"]})]})})]})};DocumentPreview.__docgenInfo={description:"",methods:[],displayName:"DocumentPreview",props:{document:{required:!0,tsType:{name:"Document"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onRequestTranslation:{required:!1,tsType:{name:"signature",type:"function",raw:"(documentId: string) => void",signature:{arguments:[{type:{name:"string"},name:"documentId"}],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}}}}},"./src/lib/hooks/useDocuments.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>useDocuments});var react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),mockToastify=__webpack_require__("./.storybook/mockToastify.ts"),dist=(__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),__webpack_require__("./node_modules/@tanstack/query-core/build/modern/queryClient.js"),__webpack_require__("./node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js"),__webpack_require__("./node_modules/@trpc/client/dist/index.mjs")),react_query_dist=__webpack_require__("./node_modules/@trpc/react-query/dist/index.mjs");__webpack_require__("./node_modules/superjson/dist/index.js"),__webpack_require__("./node_modules/process/browser.js");const api=(0,react_query_dist.pY)();(0,dist.Eh)({url:`wss://${window.location.host}`});var types=__webpack_require__("./src/lib/types.ts"),mockNextNavigation=__webpack_require__("./.storybook/mockNextNavigation.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");const useDocuments=()=>{const[isUploading,setIsUploading]=(0,react.useState)(!1),[uploadProgress,setUploadProgress]=(0,react.useState)(0),[isLoading,setIsLoading]=(0,react.useState)(!1),utils=api.useUtils();(0,mockNextNavigation.rd)();return{useDocumentsByCategory:(category,language,limit=10,offset=0,searchQuery="")=>{const query=api.documents.getDocumentsByCategory.useQuery({category,language,limit,offset,searchQuery},{staleTime:3e5});return query.error&&mockToastify.o.error(`Error fetching documents: ${query.error.message}`),query},getDocuments:async(category,language,limit=10,offset=0,searchQuery="")=>{try{setIsLoading(!0);return await utils.documents.getDocumentsByCategory.fetch({category:category||types.I7.COMITE_DE_SUIVI,language,limit,offset,searchQuery})}catch(error){return console.error("Error fetching documents:",error),mockToastify.o.error(`Error fetching documents: ${error instanceof Error?error.message:"Unknown error"}`),[]}finally{setIsLoading(!1)}},uploadDocument:async(file,title,category,language,description,parentDocumentId)=>{if(!file)return mockToastify.o.error("Please select a file to upload"),null;setIsUploading(!0),setUploadProgress(0);try{const getUploadUrlMutation=api.documents.getUploadUrl.useMutation(),{uploadUrl,filePath}=await getUploadUrlMutation.mutateAsync({fileName:file.name,fileType:file.type,fileSize:file.size,category,language}),xhr=new XMLHttpRequest;xhr.upload.addEventListener("progress",(event=>{if(event.lengthComputable){const percentComplete=Math.round(event.loaded/event.total*100);setUploadProgress(percentComplete)}}));const uploadPromise=new Promise(((resolve,reject)=>{xhr.open("PUT",uploadUrl),xhr.setRequestHeader("Content-Type",file.type),xhr.onload=()=>{200===xhr.status?resolve():reject(new Error(`Upload failed with status ${xhr.status}`))},xhr.onerror=()=>{reject(new Error("Upload failed"))},xhr.send(file)}));await uploadPromise;const createDocumentMutation=api.documents.createDocument.useMutation(),document1=await createDocumentMutation.mutateAsync({title,description,filePath,fileSize:file.size,fileType:file.type,category,language,isPublished:!0,parentDocumentId});return utils.documents.getDocumentsByCategory.invalidate({category}),mockToastify.o.success("Document uploaded successfully"),document1}catch(error){return console.error("Error uploading document:",error),mockToastify.o.error(`Error uploading document: ${error instanceof Error?error.message:"Unknown error"}`),null}finally{setIsUploading(!1),setUploadProgress(0)}},downloadDocument:async(documentId,fileName)=>{try{const incrementViewCountMutation=api.documents.incrementViewCount.useMutation();await incrementViewCountMutation.mutateAsync({documentId});const getDownloadUrlMutation=api.documents.getDownloadUrl.useMutation(),{downloadUrl}=await getDownloadUrlMutation.mutateAsync({documentId}),link=document.createElement("a");return link.href=downloadUrl,link.download=fileName,document.body.appendChild(link),link.click(),document.body.removeChild(link),!0}catch(error){return console.error("Error downloading document:",error),mockToastify.o.error(`Error downloading document: ${error instanceof Error?error.message:"Unknown error"}`),!1}},deleteDocument:async(documentId,category)=>{try{const deleteDocumentMutation=api.documents.deleteDocument.useMutation();return await deleteDocumentMutation.mutateAsync({documentId}),utils.documents.getDocumentsByCategory.invalidate({category}),mockToastify.o.success("Document deleted successfully"),!0}catch(error){return console.error("Error deleting document:",error),mockToastify.o.error(`Error deleting document: ${error instanceof Error?error.message:"Unknown error"}`),!1}},previewDocument:async id=>{try{setIsLoading(!0);const response=await fetch(`/api/documents/${id}/preview`);if(!response.ok)throw new Error("Failed to preview document");return(await response.json()).previewUrl}catch(error){return console.error("Error previewing document:",error),mockToastify.o.error("Failed to preview document"),null}finally{setIsLoading(!1)}},isUploading,uploadProgress,isLoading}}},"./src/lib/trpc/client.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{i:()=>trpc});const trpc=(0,__webpack_require__("./node_modules/@trpc/react-query/dist/index.mjs").pY)()},"./src/lib/types.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I7:()=>DocumentCategory,TM:()=>Language});var DocumentCategory=function(DocumentCategory){return DocumentCategory.COMITE_DE_SUIVI="comiteDeSuivi",DocumentCategory.SOCIETE_DE_GESTION="societeDeGestion",DocumentCategory.LEGAL="legal",DocumentCategory.GENERAL="general",DocumentCategory.FINANCE="finance",DocumentCategory}({}),Language=function(Language){return Language.FRENCH="french",Language.ARABIC="arabic",Language.ENGLISH="english",Language}({})}}]);